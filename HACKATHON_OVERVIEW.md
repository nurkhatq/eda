# Goszakup Data Collection System - ForteBank Hackathon

## Краткое описание

Полноценная система сбора и хранения данных о государственных закупках Казахстана для аналитики и принятия решений.

## Что было реализовано

### 1. API Клиент (src/goszakup_client.py)
- ✅ Поддержка всех 74 эндпоинтов API goszakup.gov.kz
- ✅ Автоматическая пагинация для больших объемов данных
- ✅ Retry механизм при ошибках сети
- ✅ Настраиваемые задержки между запросами

### 2. База данных (PostgreSQL)
- ✅ 10 основных таблиц для данных
- ✅ 30 справочных таблиц
- ✅ JSONB для гибкого хранения
- ✅ Индексы для быстрого поиска
- ✅ Views для удобного доступа

### 3. ETL Pipeline (Apache Airflow)
- ✅ Автоматический DAG для ежедневного сбора
- ✅ Параллельная загрузка данных
- ✅ Обработка ошибок и retry
- ✅ Логирование и мониторинг

### 4. Docker Infrastructure
- ✅ Docker Compose для всей инфраструктуры
- ✅ PostgreSQL для данных
- ✅ Apache Airflow
- ✅ PgAdmin для управления БД

## Категории данных

### Основные реестры:
1. **Участники** (~70,000 компаний)
   - БИН/ИИН, названия, контакты
   - Адреса, сотрудники
   - Статусы (заказчик/поставщик)

2. **Планы закупок** (~19,000 заказчиков)
   - Годовые планы
   - Пункты планов
   - Спецификации
   - Места поставки

3. **Объявления о закупках**
   - Объявления
   - Конкурсные комиссии
   - Информация о приостановлении/отмене

4. **Заявки и лоты**
   - Заявки поставщиков
   - Лоты по закупкам

5. **Договоры**
   - Полная информация о договорах
   - Предметы договоров
   - Поиск по различным критериям

6. **Исполнение**
   - Электронные акты
   - Казначейские платежи

7. **РНУ**
   - Недобросовестные поставщики
   - История включений

### Справочники (30 шт):
- Способы закупки
- Статусы (объявлений, договоров, лотов)
- Единицы измерения (МКЕЙ)
- КАТО, страны
- Типы договоров, валюты
- И другие...

## Возможности для аналитики

### Что можно анализировать:

1. **Участники рынка**
   - Топ заказчиков по объему закупок
   - Активные поставщики
   - Связи между компаниями

2. **Объемы закупок**
   - Динамика по времени
   - По регионам (КАТО)
   - По способам закупки
   - По типам предметов

3. **Эффективность**
   - Конкуренция (кол-во заявок на лот)
   - Экономия бюджета
   - Сроки исполнения договоров

4. **Риски**
   - РНУ - недобросовестные поставщики
   - Расторжения договоров
   - Несостоявшиеся закупки

5. **Финансовые потоки**
   - Платежи от казначейства
   - Авансовые платежи
   - Задолженности

## Примеры SQL запросов для аналитики

### 1. Топ-10 заказчиков по количеству договоров
```sql
SELECT
    data->>'customer_bin' as bin,
    data->>'customer_name_ru' as name,
    COUNT(*) as contract_count,
    SUM((data->>'contract_sum')::numeric) as total_sum
FROM contracts
GROUP BY data->>'customer_bin', data->>'customer_name_ru'
ORDER BY contract_count DESC
LIMIT 10;
```

### 2. Динамика объявлений по месяцам
```sql
SELECT
    DATE_TRUNC('month', (data->>'start_date')::timestamp) as month,
    COUNT(*) as announcements,
    SUM((data->>'total_sum')::numeric) as total_amount
FROM announcements
WHERE data->>'start_date' IS NOT NULL
GROUP BY month
ORDER BY month DESC;
```

### 3. Поставщики в РНУ
```sql
SELECT
    data->>'supplier_name_ru' as supplier,
    data->>'supplier_biin' as bin,
    data->>'start_date' as rnu_from,
    data->>'end_date' as rnu_to
FROM rnu
ORDER BY data->>'start_date' DESC;
```

### 4. Конкуренция по лотам
```sql
SELECT
    l.data->>'lot_number' as lot_number,
    l.data->>'name_ru' as lot_name,
    COUNT(a.id) as applications_count
FROM lots l
LEFT JOIN applications a ON a.data->>'lot_id' = l.data->>'id'
GROUP BY l.data->>'lot_number', l.data->>'name_ru'
HAVING COUNT(a.id) > 0
ORDER BY applications_count DESC
LIMIT 20;
```

## Дальнейшее развитие

### Аналитика
- [ ] Дашборды в Metabase/Superset
- [ ] Jupyter Notebook для исследований
- [ ] ML модели для предсказания цен
- [ ] Детекция аномалий и мошенничества

### Дополнительные данные
- [ ] Связи между компаниями (граф)
- [ ] Временные ряды цен
- [ ] Геолокация закупок на карте
- [ ] Интеграция с внешними источниками

### API
- [ ] REST API для доступа к данным
- [ ] GraphQL endpoint
- [ ] Real-time обновления через WebSocket

## Технический стек

- **Python 3.11** - основной язык
- **PostgreSQL 15** - хранилище данных
- **Apache Airflow 2.8** - оркестрация ETL
- **Docker & Docker Compose** - контейнеризация
- **requests** - HTTP клиент
- **psycopg2** - PostgreSQL драйвер

## Метрики проекта

- **Эндпоинтов API**: 74
- **Таблиц в БД**: 40+
- **Строк кода**: ~1,500+
- **Файлов**: 15+
- **Время разработки**: Хакатон

## Запуск в production

### Рекомендации:
1. Использовать managed PostgreSQL (AWS RDS, etc)
2. Настроить мониторинг (Prometheus + Grafana)
3. Добавить алерты в Slack/Telegram
4. Настроить бэкапы БД
5. Использовать секреты (Vault, AWS Secrets Manager)
6. Масштабировать Airflow (CeleryExecutor)

## Команда

Проект создан для ForteBank Hackathon 2024

## Лицензия

MIT License - свободное использование
